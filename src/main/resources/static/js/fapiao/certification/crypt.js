function setDeviceParam(r){0!=CryptCtrl.IsDeviceOpened()&&CryptCtrl.CloseDevice(),CryptCtrl.strContainer="",userPasswd=r}function openDevice(r){return setDeviceParam(r),0!=CryptCtrl.IsDeviceOpened()&&CryptCtrl.CloseDevice(),CryptCtrl.OpenDeviceEx(userPasswd),87==CryptCtrl.ErrCode&&CryptCtrl.OpenDeviceEx(userPasswd),0!=CryptCtrl.ErrCode&&CryptCtrl.ErrCode!=-1?(jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),CryptCtrl.ErrCode):(devicePort=CryptCtrl.strContainer,CryptCtrl.ErrCode)}function changePin(){if(0==openDevice())return CryptCtrl.ChangePinEx(),jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),CryptCtrl.ErrCode}function signData(r,e,t){var C=0;return C=openDevice(),0!=C?C:(CryptCtrl.SignData(r,r.length,"SHA1withRSA",e,t),0!=CryptCtrl.ErrCode?(jAlert("<div id='popup_message'>"+CryptCtrl.ErrMsg+"</div>","提示"),CryptCtrl.ErrCode):(strSignedCode=CryptCtrl.strResult,CryptCtrl.CloseDevice(),CryptCtrl.ErrCode))}function getCert(){var r=(openDevice(),CryptCtrl.GetCertInfo("",71),CryptCtrl.errCode),e="";return 0==r&&(e=CryptCtrl.strResult),CryptCtrl.CloseDevice(),e}var serverPacket="",clientAuthCode="",serverRandom="",operType="",userId="",userPasswd="",deviceType="",devicePort="",userName="",clientPubKey="",sysName="",sysCode="",userAccount="",userPin="",strContainer="",strProvider="",nProvType=1;