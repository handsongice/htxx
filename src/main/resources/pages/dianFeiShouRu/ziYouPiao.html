<!DOCTYPE HTML >
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/js/layui/css/layui.css">
    <link rel="stylesheet" href="/static/css/common.css"/>
    <link rel="stylesheet" href="/static/css/gdkp.css"/>
    <link rel="stylesheet" href="/static/js/font-awesome/css/font-awesome.css"/>
    <link rel="stylesheet" href="/static/css/jquery-ui-1.10.4.min.css"/>
    <script src="/static/js/jquery.min.js"></script>
    <!--<script type="text/javascript"  src="/static/js/jquery.min.js"></script>-->
    <script type="text/javascript" src="/static/js/jquery-ui-1.10.4.min.js"></script>
    <script type="text/javascript" src="/static/js/ziyoupiao.js"></script>

    <style></style>
    <!--[if lte IE 8]>
    <script src="/static/js/respond.min.js"></script>
    <![endif]-->
    <title></title>
    <style>
    </style>
</head>

<body>
<div class="padd-10 full-bg">
    <form class="layui-form search-form">
        <ul>
            <li>
                <span class="fpzl-item zyfp display-inline-block select-fpzl" th:if="${zyfp}"
                      data-value="zyfp"><label>专</label>专用发票</span>
                <span class="fpzl-item ptfp display-inline-block select-fpzl" th:if="${ptfp}"
                      data-value="ptfp"><label>普</label>普通发票</span>
                <span class="fpzl-item dzfp display-inline-block select-fpzl" th:if="${dzfp}"
                      data-value="dzfp"><label>电</label>普通发票（电子）</span>
                <span class="fpzl-item jsfp display-inline-block select-fpzl" th:if="${jsfp}"
                      data-value="jsfp"><label>卷</label>普通发票（卷）</span>
            </li>
            <button type="button" id="saveInvTemp" class="layui-btn bg-light-blue float-right"
                    style="background: #9E520A">提交审核发票
            </button>
            <div class="clear-fixed"></div>


            <div class="clear-fixed"></div>
        </ul>
    </form>

    <div id="bgdkp-table-area" class="bg-white">

        <!--<img src="/images/fp-bottom.png" id="fp2">-->
        <table class="head-table">
            <tr>
                <td rowspan="3" colspan="2" style="width: 27%;"></td>
                <td rowspan="3" class="title fp-title" style="width: 46%;">
                    <h1>增值税电子普通发票<!--<img src="/images/fp1.png" id="fp1">--></h1>
                </td>
                <td class="title head-td-height"><span class="align-justify">发票代码</span></td>
                <td class="head-td-last">037021700211</td>
            </tr>
            <tr>
                <td class="title head-td-height"><span class="align-justify">发票号码</span></td>
                <td class="head-td-last">48875988</td>
            </tr>
            <tr>
                <td class="title head-td-height"><span class="align-justify">开票日期</span></td>
                <td class="head-td-last"></td>
            </tr>
            <tr>
                <td class="title" style="padding-left: 10px;width: 5%;"></td>
                <td>&nbsp;</td>
                <td></td>
                <td class="title head-td-height"><span class="align-justify">校验码</span></td>
                <td class="head-td-last"></td>
            </tr>
        </table>
        <div class="border-area">
            <table class="border-bottom">
                <tr class="tr-1">
                    <td rowspan="4" class="border-right width-1 title align-center">
                        <span>购</span><span>买</span><span>方</span></td>
                    <td class="width-2 "><span class="align-justify height-25 title">名称</span></td>
                    <td class="width-min">:</td>
                    <td class="width-3"><input type="text" id="xxfp_gfmc" autocomplete="off" class="bgdkp-input"></td>
                    <td rowspan="4" class="border-left-right width-1 title align-center">
                        <span>密</span><span>码</span><span>区</span></td>
                    <td rowspan="4" id="mmq"></td>
                </tr>
                <tr class="tr-2">
                    <td class="width-2"><span class="align-justify height-25 title">纳税人识别号</span></td>
                    <td class="width-min">:</td>
                    <td><span class="font-1"><input type="text" id="xxfp_gfsh" autocomplete="off"
                                                    class="bgdkp-input"></span></td>
                </tr>
                <tr class="tr-3">
                    <td class="width-2"><span class="align-justify height-25 title">地址、电话</span></td>
                    <td class="width-min">:</td>
                    <td><input type="text" id="xxfp_gfdzdh" autocomplete="off" class="bgdkp-input"></td>
                </tr>
                <tr class="tr-4">
                    <td class="width-2"><span class="align-justify height-25 title">开户行及账号</span></td>
                    <td class="width-min">:</td>
                    <td><input type="text" id="xxfp_gfyhzh" autocomplete="off" class="bgdkp-input"></td>
                </tr>
            </table>
            <table class="border-bottom">
                <tr class="tr-5 align-center title border-bottom">
                    <td class="width-1 border-right-gray"><i class="fa fa-plus cursor-pointer" id="add-detail-tr"></i>
                    </td>
                    <td style="width: 27%">货物或应税劳务、服务名称</td>
                    <td style="width: 7.9%">规格型号</td>
                    <td style="width: 6% ">单位</td>
                    <td style="width: 11.5%;">数量</td>
                    <td style="width: 12.6%;">单价(含税)</td>
                    <td style="width: 15.8%;">金额(含税)</td>
                    <td style="width: 4.3%;">税率</td>
                    <td style="width: ;">税额</td>
                </tr>
                <!--<tr class="fill-tr tr-5" id="fixed-detail-tr">-->
                <!--<td class="border-right-gray align-center fpitem_mc" placeholder="请从商品编码表中的选择" onclick="fpitemClickspan(this)"><i-->
                <!--class="fa fa-minus cursor-pointer minus-detail-tr"></i></td>-->
                <!--<td><input type="text" class="bgdkp-input-detail fpitem_ggxh"></td>-->
                <!--<td><input type="text" class="bgdkp-input-detail fpitem_jldw"></td>-->
                <!--<td><input type="text" class="bgdkp-input-detail fpitem_number"></td>-->
                <!--<td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_hsdj"></td>-->
                <!--<td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_hsje"></td>-->
                <!--<td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_slv"></td>-->
                <!--<td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_shuie"></td>-->
                <!--<td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_shuie"></td>-->
                <!--<input type="text" class="bgdkp-input-detail  fpitem_shflbm" hidden="hidden">-->
                <!--<input type="text" class="bgdkp-input-detail  fpitem_yhzcnr" hidden="hidden">-->
                <!--<input type="text" class="bgdkp-input-detail fpitem_yhzclx" hidden="hidden">-->
                <!--</tr>-->
                <tbody id="invoiceDiv">
                <tr class="fill-tr tr-5 " id="fixed-detail-tr" style="display: none;">
                    <td class="border-right-gray align-center"><i
                            class="fa fa-minus cursor-pointer minus-detail-tr"></i></td>
                    <td><input type="text" class="bgdkp-input-detail fpitem_mc" placeholder="请从商品编码表中的选择"></td>
                    <td><input type="text" class="bgdkp-input-detail fpitem_ggxh"></td>
                    <td><input type="text" class="bgdkp-input-detail fpitem_jldw"></td>
                    <td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_number"></td>
                    <td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_hsdj"></td>
                    <td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_hsje"></td>
                    <td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_slv"></td>
                    <td class="align-right"><input type="text" class="bgdkp-input-detail fpitem_shuie"></td>
                    <td style="display: none;"><input type="text" class="bgdkp-input-detail  fpitem_yhzcnr"></td>
                    <td style="display: none;"><input type="text" class="bgdkp-input-detail fpitem_yhzclx"></td>
                    <td style="display: none;"><input type="text" class="bgdkp-input-detail fpitem_ssflbm"></td>
                </tr>
                </tbody>

                <tr id="blank-detail-tr" class="tr-5">
                    <td id="blank-detail-td" class="border-right-gray"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="border-bottom tr-5">
                    <td class="border-right-gray"></td>
                    <td class="align-center title">合&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计</td>
                    <td></td>
                    <td></td>
                    <td class="align-right"></td>
                    <td class="align-right"></td>
                    <td class="align-right" id="xxfp_jehj">80.14</td>
                    <td class="align-right"></td>
                    <td class="align-right" id="xxfp_sehj">20.42</td>
                </tr>
                <tr class="border-bottom">
                    <td class="border-right-gray"></td>
                    <td class="border-right height-1-x align-center title">价税合计</td>
                    <td colspan="4" id="jshj-td">
                        <!--<img src="/images/fp3.png" width="27" height="27" id="jshj-img">--><span
                            style="padding-left: 3px;"></span></td>
                    <td class="align-right title">（小写）<a id="xxfp_jshj">100.56</a></td>
                    <td colspan="2"></td>
                </tr>
            </table>
            <table>
                <tr class="tr-1">
                    <td rowspan="4" class="border-right width-1 title align-center">
                        <span>销</span><span>售</span><span>方</span></td>
                    <td class="width-2 "><span class="align-justify height-25  title">名称</span></td>
                    <td class="width-min">:</td>
                    <td class="width-3"><input type="text" id="xxfp_xfmc" class="bgdkp-input"
                                               th:value="${enterprise.name}"></td>
                    <td rowspan="4" class="border-left-right width-1 title align-center"><span>备</span><span
                            style="margin-top: 20px;">注</span></td>
                    <td rowspan="4" class="vertical-top">
                        <textarea class="bgdkp-textarea" id="xxfp_bz"></textarea>
                        <!--<p>08105美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112美金账户：中行青岛分行，223400406112</p>-->
                    </td>
                </tr>
                <tr class="tr-2">
                    <td class="width-2"><span class="align-justify height-25  title">纳税人识别号</span></td>
                    <td class="width-min">:</td>
                    <td class="font-1"><input type="text" id="xxfp_xfsh" class="bgdkp-input"
                                              th:value="${enterprise.taxNum}"></td>
                </tr>
                <tr class="tr-3">
                    <td class="width-2"><span class="align-justify height-25  title">地址、电话</span></td>
                    <td class="width-min">:</td>
                    <td><input type="text" id="xxfp_xfdzdh" class="bgdkp-input" th:value="${enterprise.addr}"></td>
                </tr>
                <tr class="tr-4">
                    <td class="width-2"><span class="align-justify height-25  title">开户行及账号</span></td>
                    <td class="width-min">:</td>
                    <td><input type="text" id="xxfp_xfyhzh" class="bgdkp-input" th:value="${enterprise.bankInfo}"></td>
                </tr>
            </table>
        </div>
        <table class="foot-table">
            <tr>
                <td class="title">收款人：</td>
                <td><input type="text" id="xxfp_skr" class="bgdkp-input" th:value="${operatorName}"></td>
                <td class="title">复核：</td>
                <td><input type="text" id="xxfp_fhr" class="bgdkp-input" th:value="${operatorName}"></td>
                <td class="title">开票人：</td>
                <td><input type="text" id="xxfp_kpr" class="bgdkp-input" th:value="${operatorName}"></td>
                <td class="title">销售方(章)：</td>
                <td style="width: 15%;"></td>
            </tr>
        </table>

    </div>
</div>
<!-- <div class="popup-area">
    <div id="select-fpzl-cont" class="padd-20">
        <ul class="align-center">
            <li class="fpzl-item dzfp display-inline-block select-fpzl" data-value="dzfp"><label>电</label>普通发票(电子)</li>
            <li class="fpzl-item ptfp display-inline-block select-fpzl" data-value="ptfp"><label>普</label>普通发票(纸质)</li>
            <li class="fpzl-item zyfp display-inline-block select-fpzl" data-value="zyfp"><label>专</label>专用发票</li>
        </ul>
    </div>
</div> -->
<!--<script src="/static/js/jquery.min.js"></script>-->
<script src="/static/js/layui/layui.js"></script>
<script src="/static/js/common.js"></script>
<script>
    var form = null;
    var layer = null;
    var active = null;
    var mSpMc = new Array();
    var SpMcObj = null;
    var currLength = 0;
    layui.use(['layer', 'form'], function () {
        layer = layui.layer;
        form = layui.form;

        generateInput();

        active = {
            submit: function () {
                console.log(this);
                var taxRateVal = $('#taxRate').val();
                var url = '/wtdj/saveOrEditWenTiDanJu?taxRate=' + taxRateVal;
                active.ajaxPost(url);

            },
            ajaxPost: function (url) {// ajax post 请求
                var indexLoading;
                $.ajax({
                    url: url,
                    type: 'post',
                    dataType: 'json',
                    beforeSend: function () {
                        indexLoading = layer.load(2, {time: 1500, shade: [0.3, '#000']});
                    },
                    success: function (rlt) {
                        //console.log(rlt);
                        if (rlt.status == '200') {
                            layer.close(indexLoading);
                            layer.msg(rlt.msg, {icon: 1, time: 1000, title: '温馨提示'}, function () {
                                //此方法一般用于在iframe页关闭自身时用到
                                var indexFrame = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                parent.layer.close(indexFrame); //再执行关闭
                            });
                        } else {
                            layer.close(indexLoading);
                            layer.alert(rlt.msg, {icon: 2, title: '温馨提示'});
                        }
                    },
                    error: function () {
                        layer.close(indexLoading);
                        layer.alert('前后台数据交互异常', {icon: 2, title: '温馨提示'});
                    }
                })
            }, getCondition: function () { //获取当前查询条件值
                moneyIncludeTax = $("#moneyIncludeTax").val();
                totalMoneyIncludeTax = $("#totalMoneyIncludeTax").val();
                taxRate = $("#taxRate").val();
                if (("" != moneyIncludeTax) && !(/^\d+(?:.\d{1,2})?$/.test(moneyIncludeTax))) {
                    console.log("商品含税金额输入不合法" + moneyIncludeTax);
                    layer.msg('商品含税金额入不合法,只能为整数或小数点2位以内的数字', {icon: 5});
                    return false;
                }
                if (("" != totalMoneyIncludeTax) && !(/^\d+(?:.\d{1,2})?$/.test(totalMoneyIncludeTax))) {
                    console.log("总含税金额输入不合法" + totalMoneyIncludeTax);
                    layer.msg('总含税金额输入不合法,只能为整数或小数点2位以内的数字', {icon: 5});
                    return false;
                }
                if (("" != taxRate) && !(/^\d+(?:.\d{1,4})?$/.test(taxRate))) {
                    console.log("商品税率输入不合法" + taxRate);
                    layer.msg('商品税率输入不合法,只能为整数或小数点4位以内的数字', {icon: 5});
                    return false;
                }
                return true;
            }
        }
        var defaultType = '[[${defaultType}]]';//默认发票票种
        //console.log(defaultType);
        switch (defaultType) {
            case '51':
                $(".dzfp").addClass("active");
                $("h1").text("增值税电子普通发票");
                break;
            case '2':
                $(".ptfp").addClass("active");
                $("h1").text("增值税普通发票");
                break;
            case '0':
                $(".zyfp").addClass("active");
                $("h1").text("增值税专用发票");
                break;
            case '41':
                $(".jsfp").addClass("active");
                $("h1").text("增值税普通发票（卷）");
                break;
            default:
                break;
        }
        form.render();
        //				layer.open({
        //					title: '请选择您要开具的发票种类',
        //					closeBtn: 0,
        //					type: 1,
        //					content: $('#select-fpzl-cont'),
        //					area: ['400px', '150px']
        //				});
        $('.select-fpzl').on('click', function () {
            var fpzl = $(this).attr("data-value");
            $('.select-fpzl').removeClass('active');
            layer.closeAll();
            switch (fpzl) {
                case 'dzfp':
                    $(".dzfp").addClass("active");
                    $("h1").text("增值税电子普通发票");
                    break;
                case 'ptfp':
                    $(".ptfp").addClass("active");
                    $("h1").text("增值税普通发票");
                    break;
                case 'zyfp':
                    $(".zyfp").addClass("active");
                    $("h1").text("增值税专用发票");
                    break;
                case 'jsfp':
                    $(".jsfp").addClass("active");
                    $("h1").text("增值税普通发票（卷）");
                    break;
                default:
                    break;
            }
        });
        //填充购买人信息
        initCustomerInfoData();

        initGoodsInfoData();

        $("#blank-detail-td").css('height', 208 - 26);
        var trNum = 1;
        var trHtml = '<tr class="fill-tr tr-5">' + $('#fixed-detail-tr').html() + '</tr>';
        $('#add-detail-tr').on('click', function () {
            /*if (trNum >= 8) {
                layer.alert('发票明细最多不超过8行！');
                return;
            }
            trNum++;
            $("#fixed-detail-tr").after(trHtml);*/
            generateInput();
        });

        $("#bgdkp-table-area").on('click', '.minus-detail-tr', function () {
            //alert($('#invoiceDiv').find('tr').length);
            if (currLength <= 1) {
                layer.alert('发票明细至少1行！', {icon: 2, title: '温馨提示'});
                return;
            }
            $(this).parents('.fill-tr').remove();
            currLength--;
            changeBlankHeight(trNum);
        });

        function changeBlankHeight(trNum) {
            $("#blank-detail-td").css('height', 208 - trNum * 26);
        }

        function generateInput() {
            var trHtml = '<tr class="fill-tr tr-5">' + $('#fixed-detail-tr').html() + '</tr>';
            console.log(currLength);
            if (currLength >= 8) {
                layer.alert('发票明细最多不超过8行！', {icon: 2, title: '温馨提示'});
                return;
            }
            $("#invoiceDiv").append(trHtml);
            currLength++;
            changeBlankHeight(trNum);
            autoComplateGoodsInfo();
        }
    });

    //购方信息初始化
    function initCustomerInfoData() {
        // var jsonObj = JSON
        $.ajax({
            type: 'POST',
            url: "/noc/zyp/findAllGfInfos",
            cache: false,
            contentType: 'application/json;charList=utf-8',
            data: "",
            success: function (data) {
                //console.info(data);
                if (data.status == '200') {
                    initAutoCompleteGouxiao(data.data);
                }
                else {
                    layer.alert(data.msg, {icon: 2, title: '温馨提示'});
                }
            },
            error: function (error) {
                //console.info(error);
                layer.alert('前后台数据交互异常', {icon: 2, title: '温馨提示'});
                return;
                //alert(error.name);
            }

        });
    }

    //商品信息初始化
    function initGoodsInfoData() {
        // var jsonObj = JSON
        $.ajax({
            type: 'POST',
            url: "/noc/zyp/findAllGoodsInfo",
            cache: false,
            contentType: 'application/json;charList=utf-8',
            async: false,
            data: "",
            success: function (data) {
                console.info(data);
                if (data.status == '200') {
                    SpMcObj = data.data;
                    for (var i = 0; i < SpMcObj.length; i++) {
                        mSpMc.push(SpMcObj[i].spmc);
                    }
                    //console.log(mSpMc);
                    //autoComplateGoodsInfo(data.data);
                    //autoComplateGoodsInfo();
                }
                else {
                    layer.alert(data.msg, {icon: 2, title: '温馨提示'});
                }
            },
            error: function (error) {
                //console.info(error);
                layer.alert('前后台数据交互异常', {icon: 2, title: '温馨提示'});
                return;
                //alert(error.name);
            }

        });
    }

    /* 初始化商品数组数组  */
    //    function autoComplateGoodsInfo(objs) {
    //         var mSpMc = new Array();
    //         for (var i = 0; i < objs.length; i++) {
    //             mSpMc.push(objs[i].spmc);
    //         }
    //        $('.fpitem_mc').autocomplete({
    //            source: mSpMc,
    //            width: 200,
    //            //height: 30,
    //            minChars: 1,
    //            autoFill: true,
    //            scrollHeight: 100,
    //            select: function (event, ui) {
    //                console.log(ui);
    //                var mc = ui.item.value;
    //                console.log(mc);
    //                for (var j = 0; j < objs.length; j++) {
    //
    //                    if (mc == objs[j].spmc) {
    ////                        console.log(objs);
    ////                        console.log(this);
    ////                        console.log($(this).parent());
    ////                        console.log($(this).parent().parent());
    ////                        console.log($(this).parent().parent().find(".slv").find(".fpitem_slv"));
    //                        $(this).parent().parent().find(".fpitem_slv").val(objs[j].sl);
    //                        $(this).parent().parent().find(".fpitem_shflbm").val(objs[j].shflbm);
    //                        break;
    //                    }
    //                }
    //            }
    //        });
    //
    //    }
    function autoComplateGoodsInfo() {
        $('.fpitem_mc').autocomplete({
            source: mSpMc,
            width: 200,
            //height: 30,
            minChars: 1,
            autoFill: true,
            scrollHeight: 100,
            select: function (event, ui) {
                var mc = ui.item.value;
                for (var j = 0; j < SpMcObj.length; j++) {
                    if (mc == SpMcObj[j].spmc) {
//                        console.log(mSpMc);
//                        console.log(this);
//                        console.log($(this).parent());
//                        console.log($(this).parent().parent());
//                        console.log($(this).parent().parent().find(".slv").find(".fpitem_slv"));
                        $(this).parent().parent().find(".fpitem_slv").val(SpMcObj[j].sl);
                        $(this).parent().parent().find(".fpitem_ssflbm").val(SpMcObj[j].shflbm);
                        break;
                    }
                }
            }
        });

    }

    /**
     * 保存自由票信息到数据库
     */
    $('#saveInvTemp').on('click', function () {
        console.log(1);
        var gfmc = $("#xxfp_gfmc").val();
        var gfsh = $("#xxfp_gfsh").val();
        var gfdzdh = $("#xxfp_gfdzdh").val();
        var gfyhzh = $("#xxfp_gfyhzh").val();


        var xfmc = $("#xxfp_xfmc").val();
        var xfsh = $("#xxfp_xfsh").val();
        var xfdzdh = $("#xxfp_xfdzdh").val();
        var xfyhzh = $("#xxfp_xfyhzh").val();


        var skr = $("#xxfp_skr").val();
        var fhr = $("#xxfp_fhr").val();
        var kpr = $("#xxfp_kpr").val();


        var hjje = $("#xxfp_jehj").html();
        var hjse = $("#xxfp_sehj").html();
        var jshj = $("#xxfp_jshj").html();

        var bz = $("#xxfp_bz").val();


        //获取各行商品信息
        var array = new Array();
        fpmxArrayPush(array);
        if (array.length <= 0) {
            layer.alert("商品明细存在问题，请仔细检查！", {icon: 2, title: '温馨提示'});
            return false;
        }

        // 对象赋值开始
        var xxfp = {};
        var mainArray = {};
        var defaultType = '[[${defaultType}]]';//默认发票票种

        //如果是专票 则购方四项必须全填
        if (defaultType == "0" && (gfmc == null || gfmc == '' ||
                gfsh == null || gfsh == '' ||
                gfdzdh == null || gfdzdh == '' ||
                gfyhzh == null || gfyhzh == '')) {
            layer.alert("当发票种类为专票时,购方信息必须全部填写!", {icon: 2, title: '温馨提示'});
            return false;
        }

        mainArray.fpType = defaultType;
        var date = new Date();
        mainArray.createTime = date;
        //dataType  0  未开票
        mainArray.dataType = 0;
        mainArray.fjh = "";

        mainArray.userName = gfmc;
        mainArray.userTaxNo = gfsh;
        mainArray.userAddr = gfdzdh;
        mainArray.userBankinfo = gfyhzh;

        mainArray.xfmc = xfmc;
        mainArray.xfsh = xfsh;
        mainArray.xfdzdh = xfdzdh;
        mainArray.xfyhzh = xfyhzh;


        mainArray.skr = skr;
        mainArray.fhr = fhr;
        mainArray.kpr = kpr;
        mainArray.hjje = Number(hjje);
        mainArray.hjse = Number(hjse);
        mainArray.totalMoneyIncludeTax = Number(jshj);
        mainArray.bz = bz;
        if (array.length > 8) {
            mainArray.qdbz = 1;
        }
        else {
            mainArray.qdbz = 0;
        }
        xxfp.dlZiyoupiao = mainArray;
        xxfp.xxfpMxs = array;
        console.log(array);
        var json = JSON.stringify(xxfp);

        console.info(json);

        $.ajax({
            type: 'POST',
            url: '/noc/zyp/saveInvTemp',
            cache: false,
            contentType: 'application/json;charset=utf-8',
            data: json,
            dataType: "json",
            success: function (data) {
                console.info(data);
                if (data.status == '200') {
                    layer.msg(data.msg, {icon: 1, time: 1000, title: '温馨提示'}, function () {
                    });
                } else {
                    layer.alert(data.msg, {icon: 2, title: '温馨提示'});

                }
            },
            error: function (error) {
                console.info(error);
                layer.alert('前后台数据交互异常', {icon: 2, title: '温馨提示'});
            }

        });

    });
</script>
</body>

</html>